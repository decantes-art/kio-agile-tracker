<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIO - Seguimiento de Actividades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/dist/phosphor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        tailwind.config = { theme: { extend: { colors: { 'kio-cyan': '#4DCFFF', 'kio-navy': '#0A0A40' } } } }
    </script>
    <style>
        :root { --kio-navy: #0A0A40; --kio-cyan: #4DCFFF; }
        body { background-color: #f3f4f6; margin: 0; font-family: sans-serif; }
        .kio-app-bar { position: fixed; top: 1.5rem; left: 50%; transform: translateX(-50%); max-width: 95%; width: 100%; border-radius: 1.5rem; z-index: 100; background: var(--kio-navy); box-shadow: 0 10px 25px rgba(0,0,0,0.4); padding: 1.5rem; color: white; }
        main { padding-top: 12rem; } 
        .kio-logo-text { color: white; text-shadow: 0 0 10px var(--kio-cyan); font-weight: 900; }
        .kanban-col { background: #e5e7eb; border-radius: 1.5rem; min-height: 500px; width: 300px; flex-shrink: 0; padding: 1.2rem; }
        .task-card { background: white; padding: 1.2rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-left: 5px solid var(--kio-cyan); margin-bottom: 1rem; }
        #login-overlay { position: fixed; inset: 0; background: #0A0A40; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <h1 class="text-6xl kio-logo-text uppercase mb-2">Kio</h1>
        <p class="text-kio-cyan font-bold tracking-[0.3em] mb-12 uppercase text-[10px]">Acceso Privado</p>
        <div id="google-btn" class="mb-10"></div>
        <button onclick="document.getElementById('login-overlay').style.display='none'" style="color:white; opacity: 0.3; text-decoration: underline; font-size: 10px; cursor: pointer; border: none; background: none;">
            OMITIR PARA REVISIÓN VISUAL
        </button>
    </div>

    <header class="kio-app-bar flex justify-between items-center">
        <div class="flex items-center gap-2">
            <span class="text-2xl kio-logo-text">KIO</span>
            <span class="text-[9px] opacity-50 uppercase font-bold border-l border-white/20 pl-2">Made to Disrupt</span>
        </div>
        <h1 class="font-bold uppercase text-xs tracking-widest">Tablero Seguimiento Actividades</h1>
        <div id="user-tag" class="text-[10px] font-bold">Invitado</div>
    </header>

    <main class="max-w-7xl mx-auto px-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 text-center text-[10px] font-bold">
            <div class="bg-white p-6 rounded-3xl border-b-8 border-red-500 shadow-sm"><p>PENDIENTES</p><p class="text-4xl font-black mt-2" id="c-back">0</p></div>
            <div class="bg-white p-6 rounded-3xl border-b-8 border-kio-cyan shadow-sm"><p>EN CURSO</p><p class="text-4xl font-black mt-2" id="c-prog">0</p></div>
            <div class="bg-white p-6 rounded-3xl border-b-8 border-green-500 shadow-sm"><p>FINALIZADO</p><p class="text-4xl font-black mt-2" id="c-done">0</p></div>
        </div>

        <div class="flex gap-6 overflow-x-auto pb-10">
            <div class="kanban-col"><h3 class="text-[10px] font-bold text-gray-400 mb-6 uppercase tracking-widest">Backlog</h3><div id="col-back" style="min-height: 400px;"></div></div>
            <div class="kanban-col"><h3 class="text-[10px] font-bold text-blue-500 mb-6 uppercase tracking-widest">En Curso</h3><div id="col-prog" style="min-height: 400px;"></div></div>
            <div class="kanban-col"><h3 class="text-[10px] font-bold text-orange-500 mb-6 uppercase tracking-widest">Revisión</h3><div id="col-rev" style="min-height: 400px;"></div></div>
            <div class="kanban-col"><h3 class="text-[10px] font-bold text-green-600 mb-6 uppercase tracking-widest">Finalizado</h3><div id="col-done" style="min-height: 400px;"></div></div>
        </div>
    </main>

    <button onclick="document.getElementById('m-task').style.display='flex'" class="fixed bottom-10 right-10 bg-[#0A0A40] text-white w-16 h-16 rounded-full shadow-2xl flex items-center justify-center z-50 border-4 border-white hover:scale-110 transition shadow-kio-cyan/20">
        <i class="ph-bold ph-plus text-3xl"></i>
    </button>

    <div id="m-task" style="position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 200;">
        <div class="bg-white p-8 rounded-[2.5rem] w-full max-w-sm">
            <h2 class="font-bold uppercase text-[10px] mb-6 tracking-widest">Nueva Actividad</h2>
            <input type="text" id="i-task" placeholder="Título..." class="w-full border-b-2 py-3 outline-none mb-8 text-sm">
            <div class="flex gap-4">
                <button onclick="document.getElementById('m-task').style.display='none'" class="flex-1 text-gray-400 text-[10px] font-bold uppercase">Cancelar</button>
                <button onclick="addT()" class="flex-1 bg-[#0A0A40] text-white py-4 rounded-2xl text-[10px] font-bold uppercase shadow-lg">Guardar</button>
            </div>
        </div>
    </div>

    <script>
    // --- CONFIGURACIÓN ---
    const SUPABASE_URL = 'https://cmtfevqonvihtqqwwqgc.supabase.co'; //
    const SUPABASE_KEY = 'sb_publishable_P7LOmUI8DJUKkIcdkDgzAg_CPOfcS4e'; //
    const GOOGLE_ID = '481012850408-jqmlauhb1qhgqe67ua1tiad1ovgj1e96.apps.googleusercontent.com'; //
    
    const supabase = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY) : null;

    async function cargarTareas() {
        if(!supabase) return;
        const { data: tareas } = await supabase.from('tareas').select('*').order('ultima_actualizacion', { ascending: false }); //
        if (!tareas) return;
        ['col-back', 'col-prog', 'col-rev', 'col-done'].forEach(id => document.getElementById(id).innerHTML = '');
        tareas.forEach(t => {
            const map = { 'Backlog': 'col-back', 'In Progress': 'col-prog', 'Review': 'col-rev', 'Done': 'col-done' }; //
            const col = document.getElementById(map[t.estado]);
            if (col) {
                const card = document.createElement('div');
                card.className = "task-card";
                card.setAttribute('data-id', t.id); //
                card.innerHTML = `<p class="text-xs font-bold text-gray-700 uppercase">${t.titulo}</p>`;
                col.appendChild(card);
            }
        });
        updateC();
    }

    async function addT() {
        const val = document.getElementById('i-task').value;
        if(!val || !supabase) return;
        await supabase.from('tareas').insert([{ titulo: val, estado: 'Backlog' }]); //
        document.getElementById('i-task').value = '';
        document.getElementById('m-task').style.display='none';
        cargarTareas(); //
    }

    async function moverTarea(id, nEst) {
        if(!supabase) return;
        const inv = { 'col-back': 'Backlog', 'col-prog': 'In Progress', 'col-rev': 'Review', 'col-done': 'Done' }; //
        await supabase.from('tareas').update({ estado: inv[nEst], ultima_actualizacion: new Date().toISOString() }).eq('id', id); //
