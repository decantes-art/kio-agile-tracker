<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIO - Gestión Ágil</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/dist/phosphor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { inter: ['Inter', 'sans-serif'] },
                    colors: {
                        'kio-cyan': '#4DCFFF', 
                        'kio-navy-darker': '#0A0A40',
                        'kio-navy-dark': '#1A1A70',
                    }
                }
            }
        }
    </script>

    <style>
        :root { --color-kio-cyan: #4DCFFF; --color-kio-navy-darker: #0A0A40; }
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; margin: 0; }
        
        .kio-app-bar-container {
            position: fixed; top: 1rem; left: 50%; transform: translateX(-50%);
            max-width: 95%; width: 100%; border-radius: 1.5rem; z-index: 50;
            background-color: var(--color-kio-navy-darker);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        
        /* Ajuste de margen para que las métricas no se escondan */
        main { padding-top: 9rem; position: relative; z-index: 10; }
        
        .kio-logo-text { color: white; text-shadow: 0 0 8px var(--color-kio-cyan); }
        .kanban-column { background: #e5e7eb; border-radius: 1.2rem; min-height: 60vh; width: 300px; flex-shrink: 0; }
        
        /* Pantalla de bloqueo */
        #login-overlay {
            position: fixed; inset: 0; background: #0A0A40; 
            z-index: 1000; display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }
    </style>
</head>
<body class="antialiased">

    <div id="login-overlay">
        <div class="text-center p-8">
            <h1 class="text-6xl font-black text-white mb-2 kio-logo-text">KIO</h1>
            <p class="text-kio-cyan font-bold tracking-[0.2em] mb-12 uppercase text-xs">Sistema de Acceso Privado</p>
            
            <div class="bg-white/5 p-8 rounded-3xl border border-white/10 backdrop-blur-md">
                <div id="google-btn"></div>
                <button onclick="entrarSinLogin()" class="mt-6 text-white/30 text-[10px] hover:text-kio-cyan transition underline uppercase tracking-widest">
                    Omitir por ahora (Solo pruebas)
                </button>
            </div>
            
            <p id="error-msg" class="text-red-400 text-xs mt-4 hidden font-bold">Acceso restringido a @kio.tech</p>
        </div>
    </div>

    <header class="kio-app-bar-container">
        <div class="px-8 h-16 sm:h-20 flex items-center relative">
            <div class="flex items-center space-x-2">
                <span class="text-2xl font-extrabold kio-logo-text">KIO</span>
                <span class="text-[10px] text-gray-400 font-bold hidden sm:block uppercase">Made to Disrupt</span>
            </div>
            <div class="flex-grow flex justify-center absolute inset-0 items-center pointer-events-none">
                <h1 class="text-white font-black tracking-widest text-sm sm:text-lg uppercase">Gestión de Proyectos Ágiles</h1>
            </div>
            <div class="ml-auto flex items-center gap-4">
                <span id="user-display" class="text-white text-[10px] font-bold hidden md:block"></span>
                <button onclick="alert('Sincronizando...')" class="text-kio-cyan border border-kio-cyan/30 px-4 py-1 rounded-full text-[10px] font-bold hover:bg-kio-cyan hover:text-kio-navy-dark transition uppercase">
                    Sync Gmail
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-red-500">
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Estancadas</p>
                <p class="text-3xl font-black text-gray-800" id="stale-count">0</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-kio-cyan">
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">En Curso</p>
                <p class="text-3xl font-black text-gray-800" id="progress-count">0</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-green-500">
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Finalizadas</p>
                <p class="text-3xl font-black text-gray-800" id="done-count">0</p>
            </div>
        </div>

        <div class="flex gap-6 overflow-x-auto pb-10">
            <div class="kanban-column p-4"><h3 class="text-[10px] font-black text-gray-500 mb-4 uppercase tracking-tighter">Backlog</h3><div class="kanban-content space-y-4 min-h-[400px]" data-status="Backlog"></div></div>
            <div class="kanban-column p-4"><h3 class="text-[10px] font-black text-gray-500 mb-4 uppercase tracking-tighter">En Curso</h3><div class="kanban-content space-y-4 min-h-[400px]" data-status="In Progress"></div></div>
            <div class="kanban-column p-4"><h3 class="text-[10px] font-black text-gray-500 mb-4 uppercase tracking-tighter text-blue-600">Revisión</h3><div class="kanban-content space-y-4 min-h-[400px]" data-status="Review"></div></div>
            <div class="kanban-column p-4"><h3 class="text-[10px] font-black text-green-600 mb-4 uppercase tracking-tighter">Finalizado</h3><div class="kanban-content space-y-4 min-h-[400px]" data-status="Done"></div></div>
        </div>
    </main>

    <button onclick="document.getElementById('taskModal').classList.remove('hidden')" class="fixed bottom-8 right-8 bg-kio-navy-dark text-white w-16 h-16 rounded-full shadow-2xl flex items-center justify-center hover:scale-110 transition-all z-40 border-4 border-white">
        <i class="ph-bold ph-plus text-2xl"></i>
    </button>

    <div id="taskModal" class="fixed inset-0 bg-kio-navy-darker/80 backdrop-blur-md z-[1100] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-kio-navy-darker p-6 flex justify-between text-white">
                <h3 class="font-bold uppercase text-xs tracking-widest">Nueva Actividad</h3>
                <button onclick="document.getElementById('taskModal').classList.add('hidden')" class="opacity-50"><i class="ph-bold ph-x"></i></button>
            </div>
            <form id="taskForm" class="p-8 space-y-4">
                <input type="text" id="taskTitle" placeholder="Nombre del proyecto" required class="w-full border-b py-2 outline-none focus:border-kio-cyan transition text-sm">
                <select id="taskPriority" class="w-full bg-gray-50 p-3 rounded-xl text-[10px] font-bold uppercase tracking-widest">
                    <option value="Baja">Prioridad Baja</option>
                    <option value="Media" selected>Prioridad Media</option>
                    <option value="Alta">Prioridad Alta</option>
                </select>
                <button type="submit" class="w-full bg-kio-navy-dark text-white font-bold py-4 rounded-2xl uppercase text-[10px] tracking-widest shadow-lg">Registrar Tarea</button>
            </form>
        </div>
    </div>

    <script>
        // Configuración temporal (Pon tus llaves reales después)
        const SUPABASE_URL = 'https://tu-url.supabase.co';
        const SUPABASE_KEY = 'tu-llave';

        window.onload = function () {
            // Inicializar Google
            if(typeof google !== 'undefined') {
                google.accounts.id.initialize({
                    client_id: "481012850408-jqmlauhb1qhgqe67ua1tiad1ovgj1e96.apps.googleusercontent.com",
                    callback: handleCredentialResponse
                });
                google.accounts.id.renderButton(document.getElementById("google-btn"), { theme: "outline", size: "large" });
            }
        }

        function handleCredentialResponse(response) {
            const data = JSON.parse(atob(response.credential.split('.')[1]));
            if (data.email.endsWith("@kio.tech")) {
                entrarSinLogin();
                document.getElementById('user-display').innerText = data.name.toUpperCase();
                document.getElementById('user-display').classList.remove('hidden');
            } else {
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }

        function entrarSinLogin() {
            document.getElementById('login-overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('login-overlay').style.display = 'none', 500);
        }

        // Simulación de Drag & Drop para que funcione visualmente ya
        document.querySelectorAll('.kanban-content').forEach(el => {
            new Sortable(el, { group: 'kanban', animation: 150 });
        });

        document.getElementById('taskForm').onsubmit = function(e) {
            e.preventDefault();
            const col = document.querySelector('[data-status="Backlog"]');
            const card = document.createElement('div');
            card.className = "bg-white p-4 rounded-2xl shadow-sm border border-gray-100 cursor-move";
            card.innerHTML = `<p class="text-xs font-bold text-gray-700">${document.getElementById('taskTitle').value}</p>`;
            col.appendChild(card);
            document.getElementById('taskModal').classList.add('hidden');
            e.target.reset();
        };
    </script>
</body>
</html>

